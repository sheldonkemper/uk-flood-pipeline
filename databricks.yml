bundle:
  name: uk-flood-pipeline

include:
  - jobs/**
  - pipelines/**

targets:
  dev:
    mode: development
    default: true
    workspace:
      host: https://adb-3577787633845022.2.azuredatabricks.net
      root_path: /Users/sheldon.kemper@outlook.com/flood-monitoring
    run_as:
      user_name: sheldon.kemper@outlook.com
    permissions:
      - level: CAN_MANAGE
        user_name: sheldon.kemper@outlook.com

    resources:
      pipelines:
        bronze_ingest:
          name: UK Flood Monitoring - Bronze Ingest
          development: true
          continuous: false
          channel: CURRENT
          photon: true
          serverless: true
          edition: ADVANCED

          # Default publishing mode: omit 'target'
          catalog: flood_dev

          configuration:
            pipelines.publishToLegacyMode: "false"
            pipeline.max_records: "100"
            pipeline.limit_per_page: "100"

          libraries:
            - notebook:
                path: ./notebooks/pipelines/bronze_ingest.ipynb

      jobs:
        bronze_ingest_job:
          name: UK Flood Monitoring - Bronze Ingest Job
          tasks:
            - task_key: bronze_ingest
              pipeline_task:
                pipeline_id: ${resources.pipelines.bronze_ingest.id}

  prod:
    mode: production
    workspace:
      host: https://adb-3577787633845022.2.azuredatabricks.net
      root_path: /Projects/flood-monitoring/prod
    run_as:
      service_principal_name: <to-be-added-sp>
    permissions:
      - level: CAN_MANAGE
        service_principal_name: <to-be-added-sp>

    resources:
      pipelines:
        bronze_ingest:
          name: UK Flood Monitoring - Bronze Ingest (Prod)
          continuous: true
          channel: CURRENT
          photon: true
          serverless: true
          edition: ADVANCED
          catalog: flood_prod

          configuration:
            pipelines.publishToLegacyMode: "false"
            pipeline.max_records: "100"
            pipeline.limit_per_page: "100"

          libraries:
            - notebook:
                path: ./notebooks/pipelines/bronze_ingest.ipynb

      jobs:
        bronze_ingest_job:
          name: UK Flood Monitoring - Bronze Ingest Job (Prod)
          tasks:
            - task_key: bronze_ingest
              pipeline_task:
                pipeline_id: ${resources.pipelines.bronze_ingest.id}
